# OpenFPGA Soft-cores Exploration Platform

The goal of the project is to co-architect open-source RISC-V soft processors (or soft-cores) and heterogeneous FPGA targets using the [OpenFPGA](https://github.com/lnis-uofu/OpenFPGA) framework.
FPGA architectural parameters include BRAM (DFF, OpenRAM) and DSP (Multiplier/Divider) sizing for low- and mid-range RISC-V processors, as presented in the table below.

<div align="center">

| **Name**                                             | **ISA**   | **Language**  | **Stages** | **Interface** | **App Range**   |
|------------------------------------------------------|-----------|---------------|------------|---------------|-----------------|
| [VexRiscv](https://github.com/SpinalHDL/VexRiscv)    | I,M,A     | Scala/Verilog | 2-5        | WB, AXI       | Low/Mid         |
| [PicoRV32](https://github.com/YosysHQ/picorv32)      | I,M,C     | Verilog       | 3          | WB, AXI       | Low (High-Perf) |
| [SERV](https://github.com/olofk/serv)                | I,M       | Verilog       | 33         | -             | Low (Low-Area)  |
| [Taiga](https://gitlab.com/sfu-rcl/Taiga)            | I,M,A     | SystemVerilog | 3          | WB            | Low             |
| [Ibex](https://github.com/lowRISC/ibex)              | I,M,C,E,B | SystemVerilog | 2          | -             | Low             |
| [RISCY](https://github.com/pulp-platform/pulpissimo) | I,M,C,F   | SystemVerilog | 4          | -             | Mid             |

</div>

## Getting Started

#### 1. Install and build the latest OpenFPGA framework version:
```bash
git clone https://github.com/lnis-uofu/OpenFPGA.git
cd OpenFPGA
make all
```

#### 2. Source the OpenFPGA environment, before running soft-core simulations:
```bash
source openfpga.sh
```

The OpenFPGA environment need to be sourced first, in order to use OpenFPGA flows and verified FPGA architectures.

#### 3. Checkout the current repository, and download submodules:
```bash
git clone --recursive https://github.com/lnis-uofu/OpenFPGA-Softcores.git
cd OpenFPGA-Softcores
```

#### 4. Source the project environment:
```bash
source setup_env.sh
```

## Tools

### 1. Run Soft-core Simulations (`run-softcore`)

Run a soft-core benchmark using an FPGA architecture with the following command:
```bash
run-softcore picorv32 fpga_archs/task_k6_frac_N10_40nm.conf --device-layout 40x40 --channel-width 150 --cache-size 2048
```

Optional arguments:
- `--device-layout <WxH>`: define a fixed FPGA layout dimension (default: auto)
- `--channel-width <integer>`: define a fixed FPGA channel width (default: auto)
- `--cache-size <integer>`: define the memory size of the softcore in Bytes (default: 1024)
- `--isa {i,im,imc}`: enable the associated RISC-V ISA extension (default: i)
  - `i`: base integer instruction set
  - `m`: enable the multiplier/divider instruction extension
  - `c`: enable the compressed instruction extension
- `--run-list <csv-file>`: run multiple simulations listed in a CSV file

### 2. Parse OpenFPGA Reports (`report-yosys-vpr`)

Parse Yosys and VPR logs and results saved in the `run_dir` directory, and generate a CSV file with the following command:
```bash
report-yosys-vpr run_dir/run* -o k6_n10_report.csv
```

Optional arguments:
- `-o <csv-file>`: save results in CSV format (default: report_parser.csv)

### 3. Place Analyzer (`report-place-analyzer`)

Parse the timing report (setup or hold) generated by VPR and extend the description for each point of the path (PB type, block ID, coordinates, ...) using *.net and *.place reports.
To 
```bash
report-place-analyzer run_dir/run001 -o path.rpt
```

Optional arguments:
- `--path-id <integer>`: print a given path number (default: 0)
- `--hold`: parse the hold timing report (default: False)
- `-o <rpt-file>`: analyze all paths in the report file and save them

